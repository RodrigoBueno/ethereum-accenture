
<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Projeto 8 / dApp f</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><h1 id="projeto-8---ethereum-decentralized-application-dapp">PROJETO 8 - Ethereum Decentralized Application (dApp)</h1>
<h2 id="material-produzido-por-bbchain.">Material produzido por <a href="http://www.bbchain.com.br">bbchain</a>.</h2>
<blockquote>
<p>Os materiais publicados nesta página são protegidos por direitos autorais e são de propriedade da bbchain, juntamente com quaisquer outros direitos de propriedade intelectual sobre tais materiais. Todos os direitos reservados. Nenhuma parte desta página pode ser copiada, reproduzida, apresentada em público, transmitida, carregada, divulgada, distribuída, modificada ou tratada de nenhuma maneira sem o consentimento prévio por escrito da bbchain e, mesmo com tal consentimento, a fonte e os direitos de propriedade devem ser reconhecidos.</p>
</blockquote>
<hr>
<h1 id="objetivo"><strong>1. Objetivo</strong></h1>
<p>Implementar uma aplicação descentralizada web usando web3.js um Smart de Jogo da Velha.</p>
<h1 id="materiais"><strong>2. Materiais</strong></h1>
<ul>
<li>[Google Chrome] (<a href="https://www.google.com/chrome/">https://www.google.com/chrome/</a>)</li>
<li>[Remix] (<a href="http://remix.ethereum.org">http://remix.ethereum.org</a>)</li>
<li>[MetaMask] (<a href="https://metamask.io/">https://metamask.io/</a>)</li>
<li>[OpenZeppelin - SafeMath] (<a href="https://openzeppelin.org/api/docs/math_SafeMath.html">https://openzeppelin.org/api/docs/math_SafeMath.html</a>)</li>
<li>[OpenZeppelin - SafeMath] (<a href="https://openzeppelin.org/api/docs/math_SafeMath.html">https://openzeppelin.org/api/docs/math_SafeMath.html</a>)</li>
<li>[Visual Studio Code] (<a href="https://code.visualstudio.com/download">https://code.visualstudio.com/download</a>) <strong>(ou outra IDE de sua preferência)</strong></li>
<li>[Node.js] (<a href="https://nodejs.org/en/">https://nodejs.org/en/</a>)</li>
<li>[serve] (<a href="https://www.npmjs.com/package/serve">https://www.npmjs.com/package/serve</a>)</li>
<li>[Terminal de Comando]</li>
</ul>
<h2 id="arquivos-solidity-que-criaremos-no-remix"><strong>2.1. Arquivos Solidity que criaremos no Remix</strong></h2>
<ul>
<li><code>JogoDaVelhaAbstrato.sol</code></li>
<li><code>SafeMath.sol</code></li>
<li><code>JogoDaVelha.sol</code></li>
</ul>
<h2 id="arquivos-da-dapp-que-criaremos-no-visual-studio-code"><strong>2.2. Arquivos da dApp que criaremos no Visual Studio Code</strong></h2>
<ul>
<li><code>index.html</code></li>
<li><code>contract.js</code></li>
<li><code>dapp.js</code></li>
</ul>
<h1 id="instruções"><strong>3. Instruções</strong></h1>
<ol>
<li>Criar um arquivo HTML que contenha os componentes visuais da aplicação (botões, campos, tabuleiro, etc) (<strong><code>index.html</code></strong>)</li>
<li><strong>Compilar</strong> o contrato <strong><code>JogoDaVelha.sol</code></strong> no <strong>Remix</strong></li>
<li>Criar um arquivo Javascript e colocar o <strong>ABI</strong> e <strong>Bytecode</strong> do contrato compilado em duas variáveis (<strong><code>contract.js</code></strong>)</li>
<li>Criar um arquivo Javascript onde iremos colocar a lógica da aplicação (<strong><code>dapp.js</code></strong>)</li>
<li>[<strong><code>dapp.js</code></strong>]  Conectar a um provedor Ethereum</li>
<li>[<strong><code>dapp.js</code></strong>]  Criar as funções e variáveis para consultar dados de um contrato e atualizar a página HTML</li>
<li>[<strong><code>dapp.js</code></strong>] Criar as funções e variáveis para enviar transações para a rede Ethereum</li>
</ol>
<h2 id="antes-de-começar">Antes de começar</h2>
<ol>
<li>Crie um pasta onde vamos criar os arquivos da nossa aplicação.</li>
</ol>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">cd</span> ~/blockchain-dev
<span class="token function">mkdir</span> dapp
<span class="token function">cd</span> dapp
</code></pre>
<ol start="2">
<li>Execute o comando <code>serve</code> para tornar todo o conteúdo desta pasta disponível via HTTP.</li>
</ol>
<pre class=" language-bash"><code class="prism  language-bash">serve
</code></pre>
<ol start="3">
<li>Abra a pasta <code>~/blockchain-dev/daap</code> no Visual Studio Code</li>
</ol>
<h3 id="criar-arquivo-html">3.1. Criar arquivo HTML</h3>
<p>No Visual Studio Code, crie um arquivo HTML que contenha os componentes visuais da aplicação (botões, campos, tabuleiro, etc).<br>
De o nome de <strong><code>index.html</code></strong>.</p>
<p>Insira o seguinte conteúdo:</p>
<pre class=" language-html"><code class="prism  language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Jogo da Velha<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!-- Web3.js --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span>  <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://rawgit.com/ethereum/web3.js/0.16.0/dist/web3.min.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>	<span class="token comment">&lt;!-- jQuery --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>https://code.jquery.com/jquery-3.3.1.min.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!-- ABI e Bytecode do contrato --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/contract.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!-- Javascript com a lógica da aplicação --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/dapp.js<span class="token punctuation">"</span></span> <span class="token attr-name">defer</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!-- Estilo do tabuleiro --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style language-css">
		<span class="token selector"><span class="token class">.grid-container</span> </span><span class="token punctuation">{</span>
			<span class="token property">display</span><span class="token punctuation">:</span> grid<span class="token punctuation">;</span>
			<span class="token property">grid-template-columns</span><span class="token punctuation">:</span> auto auto auto<span class="token punctuation">;</span>
			<span class="token property">background-color</span><span class="token punctuation">:</span> gray<span class="token punctuation">;</span>
			<span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">10</span>px<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token selector"><span class="token class">.grid-item</span> </span><span class="token punctuation">{</span>
			<span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">255</span>, <span class="token number">255</span>, <span class="token number">255</span>, <span class="token number">0.8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">1</span>px solid <span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span>, <span class="token number">0</span>, <span class="token number">0</span>, <span class="token number">0.8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">20</span>px<span class="token punctuation">;</span>
			<span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">30</span>px<span class="token punctuation">;</span>
			<span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>				
		<span class="token punctuation">}</span>
		<span class="token selector">a </span><span class="token punctuation">{</span>
			<span class="token property">color</span><span class="token punctuation">:</span> black
		<span class="token punctuation">}</span>
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Jogo da Velha<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h4</span><span class="token punctuation">&gt;</span></span>Endereço do contrato<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h4</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- Campo do endereço do contrato --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>contract-address<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span><span class="token number">250</span>px</span><span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0x592ca7de2c3fc09b9b58b12c29c98d48f35f0a63<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
		<span class="token comment">&lt;!-- Botão para recuperar um jogo a partir do endereço --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>getGame()<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Recuperar jogo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- Campo com o valor da inscrição em wei --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>valor-inscricao-new<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span><span class="token number">250</span>px</span><span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1000000000000000000<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
		<span class="token comment">&lt;!-- Botão para criar um novo contrato/jogo --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>newGame()<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Novo jogo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- Imprime o status da requisição de criar um novo contrato/jogo --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>status-new-game<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!-- Imprime o valor da inscrição do jogo --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h4</span><span class="token punctuation">&gt;</span></span>Valor da Inscrição: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>valor-inscricao<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h4</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>JOGADORES<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- Imprime o endereço do jogador 1 --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">color</span><span class="token punctuation">:</span>blue</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Jogador 1: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>jogador-1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- Imprime o endereço do jogador 2 --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">color</span><span class="token punctuation">:</span>red</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Jogador 2: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>jogador-2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- Imprime o endereço do jogador da vez --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h4</span><span class="token punctuation">&gt;</span></span>JOGADOR DA VEZ: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>jogador-da-vez<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h4</span><span class="token punctuation">&gt;</span></span>		
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!-- Imprime o status do jogo --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h4</span><span class="token punctuation">&gt;</span></span>Status do Jogo: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">color</span><span class="token punctuation">:</span>coral</span><span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>status-jogo<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h4</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>div-inscrever<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- Faz a inscrição no jogo --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>inscrever()<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>Inscrever<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>		
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span><span class="token punctuation">&gt;</span></span>TABULEIRO<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!-- Imprime o tabuleiro --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>grid-container<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>l0-c0<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>grid-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>l0-c1<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>grid-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>l0-c2<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>grid-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>l1-c0<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>grid-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>l1-c1<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>grid-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>l1-c2<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>grid-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>l2-c0<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>grid-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>l2-c1<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>grid-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>l2-c2<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>grid-item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>Abra o navegador Chrome na página: <strong><code>http://localhost:5000</code></strong></p>
<p>Observe que nenhum botão funciona. Essas funcionalidades serão implementadas no arquivo <code>dapp.js</code>.</p>
<h3 id="criar-e-compilar-smart-contracts">3.2. Criar e compilar Smart Contracts</h3>
<p>Crie os seguintes arquivos no Remix:</p>
<ol>
<li><code>JogoDaVelhaAbstrato.sol</code></li>
<li><code>SafeMath.sol</code></li>
<li><code>JogoDaVelha.sol</code></li>
</ol>
<h4 id="jogodavelhaabstrato">3.2.1. JogoDaVelhaAbstrato</h4>
<p>Insira os seguinte códigos nos respectivos arquivos:</p>
<pre class=" language-javascript"><code class="prism  language-javascript">pragma solidity <span class="token operator">^</span><span class="token number">0.4</span><span class="token punctuation">.</span><span class="token number">24</span><span class="token punctuation">;</span>

contract JogoDaVelhaAbstrato <span class="token punctuation">{</span>

	<span class="token comment">// VARIÁVEIS </span>
	address <span class="token keyword">public</span> jogador1<span class="token punctuation">;</span> <span class="token comment">// endereço do jogador 1</span>
	address <span class="token keyword">public</span> jogador2<span class="token punctuation">;</span> <span class="token comment">// endereço do jogador 2</span>
	address <span class="token keyword">public</span> jogadorDaVez<span class="token punctuation">;</span> <span class="token comment">// endereço do jogador da vez</span>
	uint <span class="token keyword">public</span> valorInscricao<span class="token punctuation">;</span> <span class="token comment">// valor da inscricao em wei</span>
	bool <span class="token keyword">public</span> fimDoJogo <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// jogo terminou (empate ou ganhador)</span>
	
	<span class="token function">mapping</span><span class="token punctuation">(</span>uint <span class="token operator">=&gt;</span> <span class="token function">mapping</span><span class="token punctuation">(</span>uint <span class="token operator">=&gt;</span> address<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">public</span> tabuleiro<span class="token punctuation">;</span> <span class="token comment">// tabuleiro[posicao_linha][posicao_coluna] = endereço_jogador</span>
    
	<span class="token comment">// FUNÇÕES </span>
	
	<span class="token comment">// Devolver dinheiro</span>
	<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> payable <span class="token keyword">public</span><span class="token punctuation">;</span>
	
	<span class="token comment">// Atribui msg.sender ao jogador 1 ou 2, define jogador da vez e emit ComecarJogo</span>
	<span class="token keyword">function</span> <span class="token function">inscrever</span><span class="token punctuation">(</span><span class="token punctuation">)</span> payable <span class="token keyword">public</span><span class="token punctuation">;</span>
	
	<span class="token comment">// Atribui valor no tabuleiro, verifica se o jogador ganhou ou houve empate e atualiza jogador da vez</span>
	<span class="token comment">// Se houve empate, devolver dinheiro para cada jogador</span>
	<span class="token comment">// Se o jogador da vez ganhou, transferir todo o dinheiro para devolver</span>
	<span class="token comment">// Emitir eventos quando necessário</span>
	<span class="token keyword">function</span> <span class="token function">jogar</span><span class="token punctuation">(</span>uint linha<span class="token punctuation">,</span> uint coluna<span class="token punctuation">)</span> payable <span class="token keyword">public</span><span class="token punctuation">;</span>
	
	<span class="token comment">// Verifica se o tabuleiro está totalmente preenchido</span>
	<span class="token keyword">function</span> <span class="token function">verificarEmpate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token function">returns</span><span class="token punctuation">(</span>bool<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// Verifia se o jogador atual ganhou</span>
	<span class="token keyword">function</span> <span class="token function">verificarSeGanhou</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token function">returns</span><span class="token punctuation">(</span>bool<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token keyword">return</span> <span class="token punctuation">(</span>
	        <span class="token comment">// linha 0</span>
	        <span class="token punctuation">(</span> tabuleiro<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> msg<span class="token punctuation">.</span>sender <span class="token operator">&amp;&amp;</span> tabuleiro<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">==</span>msg<span class="token punctuation">.</span>sender <span class="token operator">&amp;&amp;</span> tabuleiro<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">==</span>msg<span class="token punctuation">.</span>sender <span class="token punctuation">)</span> <span class="token operator">||</span> 
	        <span class="token comment">// linha 1</span>
	        <span class="token punctuation">(</span> tabuleiro<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> msg<span class="token punctuation">.</span>sender <span class="token operator">&amp;&amp;</span> tabuleiro<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">==</span>msg<span class="token punctuation">.</span>sender <span class="token operator">&amp;&amp;</span> tabuleiro<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">==</span>msg<span class="token punctuation">.</span>sender <span class="token punctuation">)</span> <span class="token operator">||</span> 
	        <span class="token comment">// linha 2</span>
	        <span class="token punctuation">(</span> tabuleiro<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> msg<span class="token punctuation">.</span>sender <span class="token operator">&amp;&amp;</span> tabuleiro<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">==</span>msg<span class="token punctuation">.</span>sender <span class="token operator">&amp;&amp;</span> tabuleiro<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">==</span>msg<span class="token punctuation">.</span>sender <span class="token punctuation">)</span> <span class="token operator">||</span> 
	        <span class="token comment">// coluna 0</span>
	        <span class="token punctuation">(</span> tabuleiro<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> msg<span class="token punctuation">.</span>sender <span class="token operator">&amp;&amp;</span> tabuleiro<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span>msg<span class="token punctuation">.</span>sender <span class="token operator">&amp;&amp;</span> tabuleiro<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span>msg<span class="token punctuation">.</span>sender <span class="token punctuation">)</span> <span class="token operator">||</span> 
	        <span class="token comment">// coluna 1</span>
	        <span class="token punctuation">(</span> tabuleiro<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> msg<span class="token punctuation">.</span>sender <span class="token operator">&amp;&amp;</span> tabuleiro<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">==</span>msg<span class="token punctuation">.</span>sender <span class="token operator">&amp;&amp;</span> tabuleiro<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">==</span>msg<span class="token punctuation">.</span>sender <span class="token punctuation">)</span> <span class="token operator">||</span> 
	        <span class="token comment">// coluna 2</span>
	        <span class="token punctuation">(</span> tabuleiro<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> msg<span class="token punctuation">.</span>sender <span class="token operator">&amp;&amp;</span> tabuleiro<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">==</span>msg<span class="token punctuation">.</span>sender <span class="token operator">&amp;&amp;</span> tabuleiro<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">==</span>msg<span class="token punctuation">.</span>sender <span class="token punctuation">)</span> <span class="token operator">||</span> 
	        <span class="token comment">// diagonal esquerda-cima, direita-baixo</span>
	        <span class="token punctuation">(</span> tabuleiro<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> msg<span class="token punctuation">.</span>sender <span class="token operator">&amp;&amp;</span> tabuleiro<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">==</span>msg<span class="token punctuation">.</span>sender <span class="token operator">&amp;&amp;</span> tabuleiro<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">==</span>msg<span class="token punctuation">.</span>sender <span class="token punctuation">)</span> <span class="token operator">||</span> 
	        <span class="token comment">// diagonal direita-cima, esquerda, baixo</span>
	        <span class="token punctuation">(</span> tabuleiro<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> msg<span class="token punctuation">.</span>sender <span class="token operator">&amp;&amp;</span> tabuleiro<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">==</span>msg<span class="token punctuation">.</span>sender <span class="token operator">&amp;&amp;</span> tabuleiro<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span>msg<span class="token punctuation">.</span>sender <span class="token punctuation">)</span>
	   <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">// EVENTOS</span>
	event <span class="token function">ComecarJogo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	event <span class="token function">JogadorDaVez</span><span class="token punctuation">(</span>address _jogadorDaVez<span class="token punctuation">)</span><span class="token punctuation">;</span>
	event <span class="token function">FimDeJogo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="safemath">3.2.2. SafeMath</h4>
<pre class=" language-javascript"><code class="prism  language-javascript">pragma solidity <span class="token operator">^</span><span class="token number">0.4</span><span class="token punctuation">.</span><span class="token number">24</span><span class="token punctuation">;</span>


<span class="token comment">/**
 * @title SafeMath
 * @dev Math operations with safety checks that throw on error
 */</span>
library SafeMath <span class="token punctuation">{</span>

  <span class="token comment">/**
  * @dev Multiplies two numbers, throws on overflow.
  */</span>
  <span class="token keyword">function</span> <span class="token function">mul</span><span class="token punctuation">(</span>uint256 a<span class="token punctuation">,</span> uint256 b<span class="token punctuation">)</span> internal pure <span class="token function">returns</span> <span class="token punctuation">(</span>uint256 c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Gas optimization: this is cheaper than asserting 'a' not being zero, but the</span>
    <span class="token comment">// benefit is lost if 'b' is also tested.</span>
    <span class="token comment">// See: https://github.com/OpenZeppelin/openzeppelin-solidity/pull/522</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    c <span class="token operator">=</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span>
    <span class="token function">assert</span><span class="token punctuation">(</span>c <span class="token operator">/</span> a <span class="token operator">==</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> c<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
  * @dev Integer division of two numbers, truncating the quotient.
  */</span>
  <span class="token keyword">function</span> <span class="token function">div</span><span class="token punctuation">(</span>uint256 a<span class="token punctuation">,</span> uint256 b<span class="token punctuation">)</span> internal pure <span class="token function">returns</span> <span class="token punctuation">(</span>uint256<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// assert(b &gt; 0); // Solidity automatically throws when dividing by 0</span>
    <span class="token comment">// uint256 c = a / b;</span>
    <span class="token comment">// assert(a == b * c + a % b); // There is no case in which this doesn't hold</span>
    <span class="token keyword">return</span> a <span class="token operator">/</span> b<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
  * @dev Subtracts two numbers, throws on overflow (i.e. if subtrahend is greater than minuend).
  */</span>
  <span class="token keyword">function</span> <span class="token function">sub</span><span class="token punctuation">(</span>uint256 a<span class="token punctuation">,</span> uint256 b<span class="token punctuation">)</span> internal pure <span class="token function">returns</span> <span class="token punctuation">(</span>uint256<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">assert</span><span class="token punctuation">(</span>b <span class="token operator">&lt;=</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
  * @dev Adds two numbers, throws on overflow.
  */</span>
  <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span>uint256 a<span class="token punctuation">,</span> uint256 b<span class="token punctuation">)</span> internal pure <span class="token function">returns</span> <span class="token punctuation">(</span>uint256 c<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    c <span class="token operator">=</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
    <span class="token function">assert</span><span class="token punctuation">(</span>c <span class="token operator">&gt;=</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> c<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Fonte:  <a href="https://github.com/OpenZeppelin/openzeppelin-solidity/blob/master/contracts/math/SafeMath.sol">https://github.com/OpenZeppelin/openzeppelin-solidity/blob/master/contracts/math/SafeMath.sol</a></p>
<h4 id="jogodavelha">3.2.3. JogoDaVelha</h4>
<pre class=" language-javascript"><code class="prism  language-javascript">pragma solidity <span class="token operator">^</span><span class="token number">0.4</span><span class="token punctuation">.</span><span class="token number">24</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">"./JogoDaVelhaAbstrato.sol"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">"./SafeMath.sol"</span><span class="token punctuation">;</span>

contract JogoDaVelha is JogoDaVelhaAbstrato <span class="token punctuation">{</span>
    using SafeMath <span class="token keyword">for</span> uint<span class="token punctuation">;</span>
    <span class="token function">constructor</span> <span class="token punctuation">(</span>uint _valorInscricao<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
	    <span class="token function">require</span><span class="token punctuation">(</span>_valorInscricao <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        valorInscricao <span class="token operator">=</span> _valorInscricao<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
    <span class="token comment">// MODIFIER</span>
    modifier <span class="token function">inscricaoAberta</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">require</span><span class="token punctuation">(</span>jogador1<span class="token operator">==</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">||</span> jogador2<span class="token operator">==</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"**Inscricao fechada"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        _<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    modifier <span class="token function">pagouInscricao</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>value <span class="token operator">==</span> valorInscricao<span class="token punctuation">,</span><span class="token string">"** Não pagou valor exata da inscricao"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        _<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    modifier <span class="token function">jogadaValida</span><span class="token punctuation">(</span>uint linha<span class="token punctuation">,</span> uint coluna<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">require</span><span class="token punctuation">(</span>fimDoJogo <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token string">"** Jogo termonou"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> jogadorDaVez<span class="token punctuation">,</span> <span class="token string">"** Você não é o jogador da vez"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">require</span><span class="token punctuation">(</span>linha<span class="token operator">&gt;=</span><span class="token number">0</span> <span class="token operator">&amp;&amp;</span> linha <span class="token operator">&lt;=</span><span class="token number">2</span> <span class="token operator">&amp;&amp;</span> coluna <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> linha <span class="token operator">&lt;=</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"** Posição inválida"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">require</span><span class="token punctuation">(</span>tabuleiro<span class="token punctuation">[</span>linha<span class="token punctuation">]</span><span class="token punctuation">[</span>coluna<span class="token punctuation">]</span><span class="token operator">==</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"** Posição já jogada"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        _<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    modifier <span class="token function">jogoComecado</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">require</span><span class="token punctuation">(</span>jogador1<span class="token operator">!=</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> jogador2<span class="token operator">!=</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"** Jogo ainda não comecou"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        _<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
	<span class="token comment">// FUNÇÕES </span>

	<span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> payable <span class="token keyword">public</span> <span class="token punctuation">{</span>
	    msg<span class="token punctuation">.</span>sender<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">function</span> <span class="token function">inscrever</span><span class="token punctuation">(</span><span class="token punctuation">)</span> inscricaoAberta pagouInscricao payable <span class="token keyword">public</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>jogador1<span class="token operator">==</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		    jogador1 <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>
		    jogadorDaVez <span class="token operator">=</span> jogador1<span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>jogador2<span class="token operator">==</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		    jogador2 <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>
		    emit <span class="token function">ComecarJogo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">function</span> <span class="token function">jogar</span><span class="token punctuation">(</span>uint linha<span class="token punctuation">,</span> uint coluna<span class="token punctuation">)</span> jogoComecado <span class="token function">jogadaValida</span><span class="token punctuation">(</span>linha<span class="token punctuation">,</span>coluna<span class="token punctuation">)</span> payable <span class="token keyword">public</span> <span class="token punctuation">{</span>
	    tabuleiro<span class="token punctuation">[</span>linha<span class="token punctuation">]</span><span class="token punctuation">[</span>coluna<span class="token punctuation">]</span> <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>
	    
	    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">verificarSeGanhou</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	        msg<span class="token punctuation">.</span>sender<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>valorInscricao<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>valorInscricao<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	        fimDoJogo <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	        emit <span class="token function">FimDeJogo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">verificarEmpate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	        jogador1<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>valorInscricao<span class="token punctuation">)</span><span class="token punctuation">;</span>
	        jogador2<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>valorInscricao<span class="token punctuation">)</span><span class="token punctuation">;</span>
	        fimDoJogo <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	        emit <span class="token function">FimDeJogo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>jogadorDaVez <span class="token operator">==</span> jogador1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	            jogadorDaVez <span class="token operator">=</span> jogador2<span class="token punctuation">;</span>
    	    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    	        jogadorDaVez <span class="token operator">=</span> jogador1<span class="token punctuation">;</span>
    	    <span class="token punctuation">}</span>
    	    emit <span class="token function">JogadorDaVez</span><span class="token punctuation">(</span>jogadorDaVez<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">function</span> <span class="token function">verificarEmpate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token function">returns</span><span class="token punctuation">(</span>bool<span class="token punctuation">)</span><span class="token punctuation">{</span>
	    <span class="token keyword">return</span> 
	        tabuleiro<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> 
	        tabuleiro<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> 
	        tabuleiro<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> 
	        tabuleiro<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> 
	        tabuleiro<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> 
	        tabuleiro<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> 
	        tabuleiro<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> 
	        tabuleiro<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> 
	        tabuleiro<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">!=</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="arquivo-javascript-com-abi-e-bytecode-do-contrato">3.3. Arquivo Javascript com <strong>ABI</strong> e <strong>Bytecode</strong> do contrato</h3>
<p>Crie um arquivo Javascript com o nome <code>contract.js</code>.</p>
<p>Copie o ABI compilado do Remix e cole em uma variável chamada <code>contractABI</code>.</p>
<p>Copie o Bytecode compilado do Remix e cole em uma variável chamada <code>contractByteCode</code>.</p>
<p>O conteúdo do arquivo deve ser similar a este:</p>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token keyword">var</span> contractABI <span class="token operator">=</span> <span class="token punctuation">[</span>
		<span class="token comment">/** ABI do Remix **/</span>
	<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> contractByteCode <span class="token operator">=</span> <span class="token string">"60806040...19f50029"</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="arquivo-javascript-da-aplicação">3.4. Arquivo Javascript da aplicação</h3>
<p>Crie um arquivo Javascript com o nome <strong><code>dapp.js</code></strong>.</p>
<p>Nesse arquivo teremos toda a lógica da aplicação.</p>
<p>Dividiremos este código em 4 bloco:</p>
<ol>
<li>Conexão com o provedor Ethereum</li>
<li>Variáveis globais da aplicação</li>
<li>Funções de consulta</li>
<li>Funções de transação</li>
</ol>
<h3 id="dapp.js--conectar-a-um-provedor-ethereum">3.5. [<strong><code>dapp.js</code></strong>]  Conectar a um provedor Ethereum</h3>
<p>Insira o seguinte código:</p>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token comment">/**
 * 1. CONECTAR A ALGUM PROVEDOR/REDE ETHEREUM
 */</span>
<span class="token comment">// [i1] Verifica se o navegador tem um provedor (ex. MetaMask ou MIST)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window<span class="token punctuation">.</span>web3 <span class="token operator">!==</span> <span class="token string">"undefined"</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> window<span class="token punctuation">.</span>web3<span class="token punctuation">.</span>currentProvider <span class="token operator">!==</span> <span class="token string">"undefined"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// [i2] Conecta ao provedor do do navegador (usando a rede e os usuário definidos no MetaMask)</span>
    <span class="token keyword">var</span> web3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Web3</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>web3<span class="token punctuation">.</span>currentProvider<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> web3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Web3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// [i3] Conecta em um provedor HTTP local (ex. Ganache ou nó/client local (ex.: GETH) )</span>
    web3<span class="token punctuation">.</span><span class="token function">setProvider</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">web3<span class="token punctuation">.</span>providers<span class="token punctuation">.</span>HttpProvider</span><span class="token punctuation">(</span><span class="token string">'http://localhost:8545'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>A instrução <code>[i1]</code> verifica se o navegador possui algum provedor de conexão com a rede Ethereum, como o MetaMask ou MIST.</p>
<p>Caso o provedor seja encontrado, a instrução <code>[i2]</code> criará uma instância do conector <code>web3</code> associado ao provedor.<br>
No caso de conexão com o MetaMask, o <code>web3</code> usará a rede atual definida no MetaMask.</p>
<p>Caso o provedor no navegador não exista, a instrução <code>[i3]</code> se conectará a um nó específico. Nesse caso, a conexão será feita em um nó local rodando na porta 8545.</p>
<h3 id="dapp.js--criar-as-funções-e-variáveis-para-fazer-consultas-e-atualizar-a-página">3.6. [<strong><code>dapp.js</code></strong>]  Criar as funções e variáveis para fazer consultas e atualizar a página</h3>
<p>Iremos utilizar 8 variáveis globais para armazenar informações que serão utilizadas dentro das funções e 7 funções para fazer consultas no Smart Contract e atualizar a página.</p>
<h4 id="variáveis-globais">3.6.1. Variáveis globais</h4>
<p>Defina as seguinte variáveis logo abaixo do bloco anterior.</p>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token comment">/**
* 2. DEFINE VARIÁVEIS DA APLICAÇÃO
*/</span>
</code></pre>
<h5 id="variável-contract">3.6.1.1.Variável <code>contract</code></h5>
<p>Essa variável define um objeto contrato usando a interface ABI (<code>contractABI</code> definido no arquivo <code>contract.js</code>) do contrato <code>JogoDaVelha.sol</code>.</p>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token comment">// Define um objeto contract com a interface ABI do Smart Contract JogoDaVelha (compilado no Remix e copiado no arquivo "contract.js")</span>
<span class="token keyword">var</span> contract <span class="token operator">=</span> web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span><span class="token function">contract</span><span class="token punctuation">(</span>contractABI<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Com esse objeto poderemos recuperar umas instância de um contrato disponível na rede ou criar uma nova instância do contrato na rede (deploy).</p>
<h5 id="variável-contractaddress">3.6.1.2.Variável <code>contractAddress</code></h5>
<p>Esta variável irá guardar o endereço atual do contrato a ser consultado. Iremos definir esse valor ao clicar no botão <code>Recuperar jogo</code> na página, a partir do valor no campo ao lado do botão.</p>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token comment">// Quando necessário, guarda o endereço de um contrato para ser carregado</span>
<span class="token keyword">var</span> contractAddress<span class="token punctuation">;</span>
</code></pre>
<h5 id="variável-contractinstance">3.6.1.3.Variável <code>contractInstance</code></h5>
<p>Esta variável receberá uma instância de um contrato na rede.</p>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token comment">// Guarda a instância de um contrato deployado na rede</span>
<span class="token keyword">var</span> contractInstance<span class="token punctuation">;</span>
</code></pre>
<h5 id="variável-jogador1">3.6.1.4.Variável <code>jogador1</code></h5>
<p>Esta variável receberá o endereço do Jogador 1 definido na instância do contrato.</p>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token comment">// Guarda o endereço do Jogador 1</span>
<span class="token keyword">var</span> jogador1<span class="token punctuation">;</span>
</code></pre>
<h5 id="variável-jogador2">3.6.1.5.Variável <code>jogador2</code></h5>
<p>Esta variável receberá o endereço do Jogador 2 definido na instância do contrato.</p>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token comment">// Guarda o endereço do Jogador 2</span>
<span class="token keyword">var</span> jogador2<span class="token punctuation">;</span>
</code></pre>
<h5 id="variável-jogadordavez">3.6.1.6.Variável <code>jogadorDaVez</code></h5>
<p>Esta variável receberá o endereço do Jogador da Vez definido na instância do contrato.</p>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token comment">// Guarda o endereço do Jogador da Vez</span>
<span class="token keyword">var</span> jogadorDaVez<span class="token punctuation">;</span>
</code></pre>
<h5 id="variável-valorinscricao">3.6.1.7.Variável <code>valorInscricao</code></h5>
<p>Esta variável receberá o valor da inscrição definido na instância do contrato.</p>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token comment">// Guarda o valor da inscrição</span>
<span class="token keyword">var</span> valorInscricao<span class="token punctuation">;</span>
</code></pre>
<h5 id="variável-minerando">3.6.1.8.Variável <code>minerando</code></h5>
<p>Essa variável será utilizada como uma flag para controlar o estado da aplicação: <code>true</code> quando houver uma transação sendo minerada e <code>false</code> quando não houver uma transação sendo minerada.</p>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token comment">// Flag que indica se alguma requisições está sendo processada/minerada</span>
<span class="token keyword">var</span> minerando <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> 
</code></pre>
<h4 id="variáveis-globais---bloco-completo">Variáveis Globais - Bloco Completo</h4>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token comment">/**
 * 2. DEFINE VARIÁVEIS DA APLICAÇÃO
 */</span>

<span class="token comment">// Define um objeto contract com a interface ABI do Smart Contract JogoDaVelha (compilado no Remix e copiado no arquivo "contract.js")</span>
<span class="token keyword">var</span> contract <span class="token operator">=</span> web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span><span class="token function">contract</span><span class="token punctuation">(</span>contractABI<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Quando necessário, guarda o endereço de um contrato para ser carregado</span>
<span class="token keyword">var</span> contractAddress<span class="token punctuation">;</span>
<span class="token comment">// Guarda a instância de um contrato deployado na rede</span>
<span class="token keyword">var</span> contractInstance<span class="token punctuation">;</span>
<span class="token comment">// Guarda o endereço do Jogador 1</span>
<span class="token keyword">var</span> jogador1<span class="token punctuation">;</span>
<span class="token comment">// Guarda o endereço do Jogador 2</span>
<span class="token keyword">var</span> jogador2<span class="token punctuation">;</span>
<span class="token comment">// Guarda o endereço do Jogador da Vez</span>
<span class="token keyword">var</span> jogadorDaVez<span class="token punctuation">;</span>
<span class="token comment">// Guarda o valor da inscrição</span>
<span class="token keyword">var</span> valorInscricao<span class="token punctuation">;</span>
<span class="token comment">// Flag que indica se alguma requisições está sendo processada/minerada</span>
<span class="token keyword">var</span> minerando <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> 
</code></pre>
<h4 id="funções-de-consulta">3.6.2. Funções de consulta</h4>
<p>Defina as seguinte funções logo abaixo do bloco anterior (variáveis).</p>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token comment">/**
* 3. REALIZAR CONSULTAS (NÃO CONSOME GAS)
*/</span>
</code></pre>
<h5 id="função--getgame">3.6.2.1. Função  <code>getGame</code></h5>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token comment">// Recupera um jogo criado na rede a partir do endereço do contrato</span>
<span class="token keyword">function</span> <span class="token function">getGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    
    <span class="token comment">// [i1] Pega o endereço no campo HTML</span>
    contractAddress <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#contract-address"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// [i2] Recupera a instância do contrato a paritr do endereço</span>
    contractInstance <span class="token operator">=</span> contract<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>contractAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// [i3] Atualiza a página HTML</span>
    <span class="token function">atualizar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>A instrução <code>[i1]</code> atribui a variável <code>contractAddress</code> o valor do <code>input</code> da página HTML que tenha <code>id="contract-address"</code>.</p>
<p>A instrução <code>[i2]</code> utiliza o endereço <code>contractAddress</code> para recuperar a instância desse contrato na rede, e atribuí essa instância à variável <code>contractInstance</code>.</p>
<p>A instrução <code>[i3]</code> chama a função <code>atualizar</code> que ainda iremos criar.</p>
<h5 id="função--atualizar">3.6.2.2. Função  <code>atualizar</code></h5>
<p>A função <code>atualizar</code> mantém a página HTML atualizada com a instância do contrato na rede.</p>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token comment">// Atualiza a página HTML com os valores do contrato</span>
<span class="token keyword">function</span> <span class="token function">atualizar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// [i1] Atualiza o valor da inscrição na página HTML</span>
    <span class="token function">getValorInscricao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// [i2] Atualiza os jogadores na página HTML</span>
    <span class="token function">getJogadores</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// [i3] Atualiza o status do jogo na página HTML</span>
    <span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// [i4] Atualiza os valores do tabuleiro na página HTML</span>
    <span class="token function">getTabuleiro</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// [i5] Repete a atualização a cada 2 segundos</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">atualizar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>A instrução <code>[i1]</code> chama a função <code>getValorInscrição</code> (que ainda iremos implementar) para atualizar na página HTML o valor da inscrição.</p>
<p>A instrução <code>[i2]</code> chama a função <code>getJogadores</code> (que ainda iremos implementar) para atualizar na página HTML os jogadores 1 e 2 e o jogador da vez.</p>
<p>A instrução <code>[i3]</code> chama a função <code>getStatus</code> (que ainda iremos implementar) para atualizar na página HTML o status do jogo.</p>
<p>A instrução <code>[i4]</code> chama a função <code>getTabuleiro</code> (que ainda iremos implementar) para atualizar na página HTML o tabuleiro.</p>
<p>A instrução <code>[i5]</code> chama novamente a função <code>atualizar</code> a cada 2 segundo.</p>
<h5 id="função--getvalorinscricao">3.6.2.3. Função  <code>getValorInscricao</code></h5>
<p>A função <code>getValorInscricao</code> atualiza a página HTML com o valor da variável <code>valorInscricao</code> da instância do contrato.</p>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token comment">// Atualiza a página com o valor da inscrição da instância do contrato</span>
<span class="token keyword">function</span> <span class="token function">getValorInscricao</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Faz uma chamada para a rede para recuperar o valor da variável valorInscricao da instância do contrato</span>
    <span class="token comment">// Uma função 'callback' deve ser passada por parâmetro</span>
    <span class="token comment">// [i1] A função 'callback' será chamada assim que a requisição retornar um valor (err e rs)</span>
    contractInstance<span class="token punctuation">.</span>valorInscricao<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>rs<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// Variáveis "uint" são retornadas como objetos que representam números grandes de uma maneria otimizada</span>
        <span class="token comment">// [i2] Para transformar esse objeto em um númor, deve ser realizada a seguinte transformação</span>
        <span class="token keyword">var</span> valorEmFormatoNumerico <span class="token operator">=</span> web3<span class="token punctuation">.</span><span class="token function">toBigNumber</span><span class="token punctuation">(</span>rs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// [i3] Atualiza o componente HTML de id="valor-inscricao" com o valor da inscrição divido por 1000000000000000000 (para representar o valor em ether)</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#valor-inscricao"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">(</span>valorEmFormatoNumerico<span class="token operator">/</span><span class="token number">1000000000000000000</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" ether"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// [i4] atualiza a variável valor inscrição</span>
        valorInscricao <span class="token operator">=</span> valorEmFormatoNumerico<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>						
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>A instrução <code>[i1]</code> faz uma chamada para a rede para recuperar o valor da variável <code>valorInscricao</code> da instância do contrato. Uma função <code>callback</code> deve ser passada por parâmetro a qual será chamada assim que a requisição retornar algum valor. Esses valores são passados nos parâmetros <code>err</code> (erro) e <code>rs</code> (resultado).</p>
<p>A instrução <code>[i2]</code> transforma o objeto retornado (<code>rs</code>) em um número, pois <code>uint</code> é representado como um objeto, e atribui a variável local <code>valorEmFormatoNumerico</code>.</p>
<p>A instrução <code>[i3]</code> atualiza o componente HTML com <code>id="valor-inscricao"</code> com o valor <code>valorEmFormatoNumerico</code> em <code>ether</code>.</p>
<p>A instrução <code>[i4]</code> atualiza a variável <code>valorInscricao</code> com o valor da variável <code>valorEmFormatoNumerico</code>.</p>
<h5 id="função--getjogadores">3.6.2.4. Função  <code>getJogadores</code></h5>
<p>A função <code>getJogadores</code> atualiza a página HTML com os jogadores 1 e 2 e o jogador da vez a partir da instância do contrato.</p>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token comment">// Atualiza os Jogadores 1 e 2 e o Jogador da Vez</span>
<span class="token keyword">function</span> <span class="token function">getJogadores</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
    <span class="token comment">// [i1] Faz uma chamada para a rede para recuperar o valor da variável "jogador1" da instância do contrato</span>
    contractInstance<span class="token punctuation">.</span>jogador1<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>rs<span class="token punctuation">)</span><span class="token punctuation">{</span>                               
        <span class="token comment">// [i2] Atualiza a variavel jogador1</span>
        jogador1 <span class="token operator">=</span> rs<span class="token punctuation">;</span>
        <span class="token comment">// [i3] Atualiza o HTML com o endereço do jogador 1</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#jogador-1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>jogador1<span class="token punctuation">)</span><span class="token punctuation">;</span>        
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		
    <span class="token comment">// [i4] Faz uma chamada para a rede para recuperar o valor da variável "jogador2" da instância do contrato				</span>
    contractInstance<span class="token punctuation">.</span>jogador2<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>rs<span class="token punctuation">)</span><span class="token punctuation">{</span> 
        <span class="token comment">// [i5] Atualiza a variavel jogador1                              </span>
        jogador2 <span class="token operator">=</span> rs<span class="token punctuation">;</span>
        <span class="token comment">// [i6] Atualiza o HTML com o endereço do jogador 2</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#jogador-2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>jogador2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// [i7] Faz uma chamada para a rede para recuperar o valor da variável "jogadorDaVez" da instância do contrato</span>
    contractInstance<span class="token punctuation">.</span>jogadorDaVez<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>rs<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// [i8] verifica se o jogador da vez foi definido</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>rs<span class="token operator">!=</span><span class="token string">"0x0000000000000000000000000000000000000000"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// [i9] atualiza a variavel jogadorDaVez</span>
            jogadorDaVez <span class="token operator">=</span> rs<span class="token punctuation">;</span>            
            <span class="token comment">// [i10] atualiza o HTML com o jogador da vez            </span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#jogador-da-vez"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">(</span>jogadorDaVez<span class="token operator">==</span>jogador1<span class="token operator">?</span><span class="token string">'&lt;b style="color:blue"&gt;JOGADOR 1&lt;/b&gt;'</span><span class="token punctuation">:</span><span class="token string">'&lt;b style="color:red"&gt;JOGADOR 2&lt;/b&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                  
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>A instrução <code>[i1]</code> faz uma chamada para a rede para recuperar o valor da variável <code>jogador1</code> da instância do contrato.</p>
<p>A instrução <code>[i2]</code> atualiza a variável <code>jogador1</code> com o resultado da chamada a instância do contrato.</p>
<p>A instrução <code>[i3]</code> atualiza o componente HTML com <code>id="jogador-1"</code> com o valor da variável <code>jogador1</code>.</p>
<p>A instrução <code>[i4]</code> faz uma chamada para a rede para recuperar o valor da variável <code>jogador2</code> da instância do<br>
contrato.</p>
<p>A instrução <code>[i5]</code> atualiza a variável <code>jogador2</code> com o resultado da chamada a instância do contrato.</p>
<p>A instrução <code>[i6]</code> atualiza o componente HTML com <code>id="jogador-2"</code> com o valor da variável <code>jogador2</code>.</p>
<p>A instrução <code>[i7]</code> faz uma chamada para a rede para recuperar o valor da variável <code>jogadorDaVez</code> da instância do<br>
contrato.</p>
<p>A instrução <code>[i8]</code> verifica se o <code>jogadorDaVez</code> foi definido.</p>
<p>A instrução <code>[i9]</code> atualiza a variável <code>jogadorDaVez</code> com o resultado da chamada a instância do contrato.</p>
<p>A instrução <code>[i10]</code> atualiza o componente HTML com <code>id="jogador-da-vez"</code> com o valor da variável <code>jogadorDaVez</code>.</p>
<h5 id="função--getstatus">3.6.2.5. Função  <code>getStatus</code></h5>
<p>A função <code>getStatus</code> atualiza a página HTML com o status do jogo com base na instância do contrato.</p>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token comment">// Atualiza o statudo do jogo</span>
<span class="token keyword">function</span> <span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token comment">// [i1] faz uma chamada para a função verificarEmpate da instância do contrato</span>
    contractInstance<span class="token punctuation">.</span>verificarEmpate<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>empate<span class="token punctuation">)</span><span class="token punctuation">{</span>   
        <span class="token comment">// [i2] faz uma chamada para a função verificarSeGanhou da instância do contrato             </span>
        contractInstance<span class="token punctuation">.</span>verificarSeGanhou<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>ganhou<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// [i3] verifica a flag "minerando" (definida como "true" no bloco de código seguinte)</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>minerando<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#status-jogo"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"MINERANDO..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token comment">// [i4] se verificarEmpate retorna "true" atualiza HTML com novo status</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>empate<span class="token punctuation">)</span> <span class="token punctuation">{</span>                
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#status-jogo"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"TERMINOU EMPATADO"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token comment">// [i5] se verificarSeGanhou retorna "true" atualiza HTML com novo status</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ganhou<span class="token punctuation">)</span> <span class="token punctuation">{</span>                
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#status-jogo"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"TERMINOU COM GANHADOR"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token comment">// [i6] verifica se o jogador2 foi definido e atualiza HTML com novo status</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>jogador2<span class="token operator">==</span><span class="token string">"0x0000000000000000000000000000000000000000"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#status-jogo"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"INSCRIÇÕES ABERTAS"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                      
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// [i7] atualiza HTML com novo status</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#status-jogo"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"EM ANDAMENTO"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  
            <span class="token punctuation">}</span>                
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>						
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>A instrução <code>[i1]</code> faz uma chamada para a função <code>verificarEmpate</code> da instância do contrato.</p>
<p>A instrução <code>[i2]</code> faz uma chamada para a função <code>verificarSeGanhou</code> da instância do contrato.</p>
<p>A instrução <code>[i3]</code> verifica se a <em>flag</em> <code>minerando</code> (definida como <code>true</code> no bloco de código seguinte) está setado como <code>true</code> e atualiza o status no status no HTML.</p>
<p>A instrução <code>[i4]</code> verifica se o resultado da função <code>verificarEmpate</code> é <code>true</code> e atualiza o status no HTML.</p>
<p>A instrução <code>[i5]</code> verifica se o resultado da função <code>verificarSeGanhou</code> é <code>true</code> e atualiza o status no HTML.</p>
<p>A instrução <code>[i6]</code> verifica se o <code>jogador2</code> foi definido e atualiza o status no HTML.</p>
<p>A instrução <code>[i7]</code> atualiza o status no HTML.</p>
<h5 id="função--gettabuleiro">3.6.2.6. Função  <code>getTabuleiro</code></h5>
<p>A função <code>getTabuleiro</code> atualiza a página HTML com os valores da variável <code>tabuleiro</code> da instância do contrato.</p>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token comment">// Atualiza a página HTML com os valores da variável `tabuleiro` da instância do contrato. </span>
<span class="token keyword">function</span> <span class="token function">getTabuleiro</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// [i1] a função getCelula reupera o valor da célula (posição linha/coluna) na instância do contrato e atuliza o HTML</span>
    <span class="token function">getCelula</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">getCelula</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">getCelula</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">getCelula</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">getCelula</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">getCelula</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">getCelula</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">getCelula</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">getCelula</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>A instrução <code>[i1]</code> chama a função <code>getCelula</code> (que ainda iremos implementar) recupera o valor da célula (na posição linha/coluna) da instância do contrato e atualiza o HTML</p>
<h5 id="função--getcelula">3.6.2.7. Função  <code>getCelula</code></h5>
<p>A função <code>getCelula</code> recupera o valor de uma célula na posição linha/coluna da instância do contrato e atualiza o HTML</p>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token comment">// Recupera o valor de uma célula na posição linha/coluna da instância do contrato e atualiza o HTML</span>
<span class="token keyword">function</span> <span class="token function">getCelula</span><span class="token punctuation">(</span>linha<span class="token punctuation">,</span> coluna<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// [i1] faz uma chamada para a instância do contrato para a variável tabuleiro passando por parâmetro as chaves linha e coluna</span>
    contractInstance<span class="token punctuation">.</span>tabuleiro<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>linha<span class="token punctuation">,</span>coluna<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>rs<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// [i2] verifica se alguém não jogou na posição</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>rs<span class="token operator">==</span><span class="token string">"0x0000000000000000000000000000000000000000"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// [i3] atualiza o HTML na linha/coluna com um link para "jogar"</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`#l</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>linha<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-c</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>coluna<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`&lt;a href="javascript:jogar(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>linha<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>coluna<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)"&gt;JOGAR&lt;/a&gt;`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// [i4] atualiza o HTML na linha/coluna com o nome do jogador que jogou na posição</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`#l</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>linha<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-c</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>coluna<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>rs<span class="token operator">==</span>jogador1<span class="token operator">?</span><span class="token template-string"><span class="token string">`&lt;b style="color:blue"&gt;JOGADOR 1&lt;/b&gt;`</span></span><span class="token punctuation">:</span><span class="token template-string"><span class="token string">`&lt;b style="color:red"&gt;JOGADOR 2&lt;/b&gt;`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>        
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>A instrução <code>[i1]</code> faz uma chamada para a rede para recuperar o valor da variável <code>tabuleiro</code> da instância do contrato na posição <code>linha</code>/<code>coluna</code>.</p>
<p>A instrução <code>[i2]</code> verifica se a célula não foi jogada ainda.</p>
<p>A instrução <code>[i3]</code> atualiza o HTML com um link para chamar a função <code>jogar</code> (que iremos implementar a seguir)</p>
<p>A instrução <code>[i4]</code> atualiza o HTML com o nome do jogador que jogou na célula</p>
<h4 id="funções-de-consulta---bloco-completo">Funções de Consulta - Bloco Completo</h4>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token comment">/** 
 * 3. REALIZAR CONSULTAS (NÃO CONSOME GAS)
 **/</span>

<span class="token comment">// Recupera um jogo criado na rede a partir do endereço do contrato</span>
<span class="token keyword">function</span> <span class="token function">getGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    
    <span class="token comment">// Pega o endereço no campo HTML</span>
    contractAddress <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#contract-address"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Recupera a instância do contrato a paritr do endereço</span>
    contractInstance <span class="token operator">=</span> contract<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>contractAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Atualiza a página HTML</span>
    <span class="token function">atualizar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Atualiza a página HTML com os valores do contrato</span>
<span class="token keyword">function</span> <span class="token function">atualizar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Atualiza o valor da inscrição na página HTML</span>
    <span class="token function">getValorInscricao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Atualiza os jogadores na página HTML</span>
    <span class="token function">getJogadores</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Atualiza o status do jogo na página HTML</span>
    <span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Atualiza os valores do tabuleiro na página HTML</span>
    <span class="token function">getTabuleiro</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Repete a atualização a cada 2 segundos</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">atualizar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Atualiza a página com o valor da inscrição da instância do contrato</span>
<span class="token keyword">function</span> <span class="token function">getValorInscricao</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Faz uma chamada para a rede para recuperar o valor da variável valorInscricao da instância do contrato</span>
    <span class="token comment">// Uma função 'callback' deve ser passada por parâmetro</span>
    <span class="token comment">// A função 'callback' será chamada assim que a requisição retornar um valor (err e rs)</span>
    contractInstance<span class="token punctuation">.</span>valorInscricao<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>rs<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// Variáveis "uint" são retornadas como objetos que representam números grandes de uma maneria otimizada</span>
        <span class="token comment">// Para transformar esse objeto em um númor, deve ser realizada a seguinte transformação</span>
        <span class="token keyword">var</span> valorEmFormatoNumerico <span class="token operator">=</span> web3<span class="token punctuation">.</span><span class="token function">toBigNumber</span><span class="token punctuation">(</span>rs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Atualiza o componente HTML de id="valor-inscricao" com o valor da inscrição divido por 1000000000000000000 (para representar o valor em ether)</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#valor-inscricao"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">(</span>valorEmFormatoNumerico<span class="token operator">/</span><span class="token number">1000000000000000000</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" ether"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// atualiza a variável valor inscrição</span>
        valorInscricao <span class="token operator">=</span> valorEmFormatoNumerico<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>						
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Atualiza os Jogadores 1 e 2 e o Jogador da Vez</span>
<span class="token keyword">function</span> <span class="token function">getJogadores</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
    <span class="token comment">// Faz uma chamada para a rede para recuperar o valor da variável "jogador1" da instância do contrato</span>
    contractInstance<span class="token punctuation">.</span>jogador1<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>rs<span class="token punctuation">)</span><span class="token punctuation">{</span>                               
        <span class="token comment">// Atualiza a variavel jogador1</span>
        jogador1 <span class="token operator">=</span> rs<span class="token punctuation">;</span>
        <span class="token comment">// Atualiza o HTML com o endereço do jogador 1</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#jogador-1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>jogador1<span class="token punctuation">)</span><span class="token punctuation">;</span>        
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		
    <span class="token comment">// Faz uma chamada para a rede para recuperar o valor da variável "jogador2" da instância do contrato				</span>
    contractInstance<span class="token punctuation">.</span>jogador2<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>rs<span class="token punctuation">)</span><span class="token punctuation">{</span> 
        <span class="token comment">// Atualiza a variavel jogador1                              </span>
        jogador2 <span class="token operator">=</span> rs<span class="token punctuation">;</span>
        <span class="token comment">// Atualiza o HTML com o endereço do jogador 2</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#jogador-2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>jogador2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Faz uma chamada para a rede para recuperar o valor da variável "jogadorDaVez" da instância do contrato</span>
    contractInstance<span class="token punctuation">.</span>jogadorDaVez<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>rs<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// verifica se o jogador da vez foi definido</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>rs<span class="token operator">!=</span><span class="token string">"0x0000000000000000000000000000000000000000"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// atualiza a variavel jogadorDaVez</span>
            jogadorDaVez <span class="token operator">=</span> rs<span class="token punctuation">;</span>            
            <span class="token comment">// atualiza o HTML com o jogador da vez            </span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#jogador-da-vez"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">(</span>jogadorDaVez<span class="token operator">==</span>jogador1<span class="token operator">?</span><span class="token string">'&lt;b style="color:blue"&gt;JOGADOR 1&lt;/b&gt;'</span><span class="token punctuation">:</span><span class="token string">'&lt;b style="color:red"&gt;JOGADOR 2&lt;/b&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                  
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Atualiza o statudo do jogo</span>
<span class="token keyword">function</span> <span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token comment">// faz uma chamada para a função verificarEmpate da instância do contrato</span>
    contractInstance<span class="token punctuation">.</span>verificarEmpate<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>empate<span class="token punctuation">)</span><span class="token punctuation">{</span>   
        <span class="token comment">// faz uma chamada para a função verificarSeGanhou da instância do contrato             </span>
        contractInstance<span class="token punctuation">.</span>verificarSeGanhou<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>ganhou<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// verifica a flag "minerando" (definida como "true" no bloco de código seguinte)</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>minerando<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#status-jogo"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"MINERANDO..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token comment">// se verificarEmpate retorna "true" atualiza HTML com novo status</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>empate<span class="token punctuation">)</span> <span class="token punctuation">{</span>                
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#status-jogo"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"TERMINOU EMPATADO"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token comment">// se verificarSeGanhou retorna "true" atualiza HTML com novo status</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ganhou<span class="token punctuation">)</span> <span class="token punctuation">{</span>                
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#status-jogo"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"TERMINOU COM GANHADOR"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token comment">// verifica se o jogador2 foi definido e atualiza HTML com novo status</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>jogador2<span class="token operator">==</span><span class="token string">"0x0000000000000000000000000000000000000000"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#status-jogo"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"INSCRIÇÕES ABERTAS"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                      
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// atualiza HTML com novo status</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#status-jogo"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"EM ANDAMENTO"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  
            <span class="token punctuation">}</span>                
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>						
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Atualiza a página HTML com os valores da variável `tabuleiro` da instância do contrato. </span>
<span class="token keyword">function</span> <span class="token function">getTabuleiro</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// a função getCelula reupera o valor da célula (posição linha/coluna) na instância do contrato e atuliza o HTML</span>
    <span class="token function">getCelula</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token function">getCelula</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token function">getCelula</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token function">getCelula</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token function">getCelula</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token function">getCelula</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token function">getCelula</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token function">getCelula</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token function">getCelula</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Recupera o valor de uma célula na posição linha/coluna da instância do contrato e atualiza o HTML</span>
<span class="token keyword">function</span> <span class="token function">getCelula</span><span class="token punctuation">(</span>linha<span class="token punctuation">,</span> coluna<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// faz uma chamada para a instância do contrato para a variável tabuleiro passando por parâmetro as chaves linha e coluna</span>
    contractInstance<span class="token punctuation">.</span>tabuleiro<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>linha<span class="token punctuation">,</span>coluna<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>rs<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// verifica se alguém jogou na posição</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>rs<span class="token operator">==</span><span class="token string">"0x0000000000000000000000000000000000000000"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// atualiza o HTML na linha/coluna com um link para "jogar"</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`#l</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>linha<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-c</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>coluna<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`&lt;a href="javascript:jogar(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>linha<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>coluna<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)"&gt;JOGAR&lt;/a&gt;`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// atualiza o HTML na linha/coluna com o nome do jogador que jogou na posição</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`#l</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>linha<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-c</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>coluna<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>rs<span class="token operator">==</span>jogador1<span class="token operator">?</span><span class="token template-string"><span class="token string">`&lt;b style="color:blue"&gt;JOGADOR 1&lt;/b&gt;`</span></span><span class="token punctuation">:</span><span class="token template-string"><span class="token string">`&lt;b style="color:red"&gt;JOGADOR 2&lt;/b&gt;`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>        
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="dapp.js-funções-de-transações-para-a-rede-ethereum">3.7. [<strong><code>dapp.js</code></strong>] Funções de transações para a rede Ethereum</h3>
<h4 id="funções-de-execução">3.7.1 Funções de execução</h4>
<p>Funções de execução são funções que consomem <strong>gas</strong>, alterando o estado do Smart Contract</p>
<h5 id="função-newgame">3.7.1.1 Função <code>newGame</code></h5>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token comment">// Cria um novo jogo (deploy de um novo contrato)</span>
<span class="token keyword">function</span> <span class="token function">newGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">//[i1]parametros utilizados para a construção do contrato do jogo</span>
    <span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
	    <span class="token comment">//[i2]valor em gas que será pago para a transação</span>
        gas<span class="token punctuation">:</span> <span class="token number">3000000</span><span class="token punctuation">,</span>        
        <span class="token comment">//[i3]quem irá assinar a transação</span>
        <span class="token keyword">from</span><span class="token punctuation">:</span> web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span>defaultAccount<span class="token punctuation">,</span>
        <span class="token comment">//[i4]binário do smart contract que será executado        </span>
        data<span class="token punctuation">:</span> contractByteCode
    <span class="token punctuation">}</span><span class="token punctuation">;</span>    
    <span class="token comment">//[i5]parametro específico do construtor do jogo, no caso o valor da inscrição</span>
    <span class="token keyword">var</span> constructorParam <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#valor-inscricao-new"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//[i6]o contrato é construído utilizando tanto a variável que informa quem vai pagar quanto a variável do volor</span>
    contractInstance <span class="token operator">=</span> contract<span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>constructorParam<span class="token punctuation">,</span> params<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>rs<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">//[i7]está é uma função de callback que é executada ao ser executada a transação</span>
    <span class="token comment">//[i8]validando que existe o objeto de retorno "rs" e no retorno, temos o endereço do contrato que foi criado</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>rs <span class="token operator">&amp;&amp;</span> rs<span class="token punctuation">.</span>address<span class="token punctuation">)</span><span class="token punctuation">{</span>
	        <span class="token comment">//[i9] como temos o valor de retorno, podemos construir os novos objetos e informar que o jogo foi criado</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#contract-address"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>            
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#status-new-game"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"Jogo criado."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            valorInscricao <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#valor-inscricao-new"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">atualizar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//[i10]caso não retorne, significa que não terminou de executar a transação, ficar em aguardo</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#status-new-game"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"Aguardando confirmação...."</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>        
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>A instrução <code>[i1]</code> faz uma chamada para a rede para criar um novo smart contract de jogo da velha.<br>
A instrução <code>[i2]</code> define a quantidade de <code>gas</code> que será utilizado para executar a transação.<br>
A instrução <code>[i3]</code> define quem irá fazer a <code>assinatura</code> da transação e pagar os custos de <code>gas</code>.<br>
A instrução <code>[i4]</code> define qual o <code>binário do smart contract</code> que será iremos implantar na rede.<br>
A instrução <code>[i5]</code> constrói o <code>parâmetro</code> que será utilizado no <code>construtor</code> do smart contract.<br>
A instrução <code>[i6]</code> executa na rede a instrução de <code>deploy</code> do smart contract.<br>
A instrução <code>[i7]</code> define a função que irá ser utilizada quando a transação for retornada da rede.<br>
A instrução <code>[i8]</code> verifica se o retorno foi positivo ou negativo da transação, caso seja sucesso executamos a instrução <code>[i9]</code>.<br>
A instrução <code>[i9]</code> modifica o HTML da página adicionando as informações de conclusão da transação.<br>
A instrução <code>[i10]</code> caso o retorno não seja positivo, significa que a transação ainda está sendo minerada.</p>
<h5 id="função-jogar">3.7.1.2 Função <code>jogar</code></h5>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token comment">//[i1]A função jogar, irá realizar a execução da função "jogar" do smart contract, são recebido os parâmetros </span>
<span class="token comment">// "linha" e "coluna" que representam a posição na tabela do jogo da velha que será preenchida</span>
<span class="token keyword">function</span> <span class="token function">jogar</span><span class="token punctuation">(</span>linha<span class="token punctuation">,</span> coluna<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
	<span class="token comment">//[i1]parametros que serão usados para a execução da transação</span>
    <span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
	    <span class="token comment">//[i2]quantidade de gas que será utilizado</span>
        gas<span class="token punctuation">:</span> <span class="token number">3000000</span><span class="token punctuation">,</span>        
        <span class="token comment">//[i3]endereço de quem irá assinar a transação</span>
        <span class="token keyword">from</span><span class="token punctuation">:</span> web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span>defaultAccount<span class="token punctuation">,</span>        
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">//[i4]A partir do contrato, executamos a função "jogar" passando a linha e coluna recebida </span>
    <span class="token comment">// e passando os parâmetros de execução que está presente em "params"</span>
    contractInstance<span class="token punctuation">.</span>jogar<span class="token punctuation">.</span><span class="token function">sendTransaction</span><span class="token punctuation">(</span>linha<span class="token punctuation">,</span> coluna<span class="token punctuation">,</span> params<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>tx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token comment">//[i5]Esta função será executada quando tivermos retorno da execução da função "jogar"</span>
	    <span class="token comment">//[i6]Ao conseguir jogar, verificamos o retorno da transação</span>
        <span class="token function">verificarTransacao</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>A instrução <code>[i1]</code>  é a função que irá executar a função <code>jogar</code> dentro da rede.<br>
A instrução <code>[i2]</code> quantidade de <code>gas</code> que será utilizado para executar a função <code>jogar</code>.<br>
A instrução <code>[i3]</code> endereço que será usado para assinar a transação.<br>
A instrução <code>[i4]</code> executa a função <code>jogar</code> na rede, passando os parâmetros <code>linha</code> e <code>coluna</code> que representam a posição no tabuleiro que deve ser jogada.<br>
A instrução <code>[i5]</code>  função que é executada quando tivermos retorno da rede sobre a execução da função.<br>
A instrução <code>[i6]</code>  executa a função que fica aguardando a mineração da execução da função.</p>
<h5 id="função-inscrever">3.7.1.3 Função <code>inscrever</code></h5>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token comment">//[i1] A função "inscrever" irá fazer a inscrição do jogador em um jogo da velha, utilizando o usuário que está acessando o site como assinante</span>
<span class="token keyword">function</span> <span class="token function">inscrever</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
	<span class="token comment">//[i2]parametros que serão usados para a execução da transação</span>
    <span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
	    <span class="token comment">//[i3]quantidade de gas que será utilizado</span>
        gas<span class="token punctuation">:</span> <span class="token number">3000000</span><span class="token punctuation">,</span>        
        <span class="token comment">//[i4]endereço de quem irá assinar a transação</span>
        <span class="token keyword">from</span><span class="token punctuation">:</span> web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span>defaultAccount<span class="token punctuation">,</span>
        <span class="token comment">//[i5]valor em Ether que será pago para a inscrição</span>
        value<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>valorInscricao<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>        
	<span class="token comment">//[i6]executa a função inscrever do smart contrat utilizando como parametros os valores passados em "params"</span>
   contractInstance<span class="token punctuation">.</span>inscrever<span class="token punctuation">.</span><span class="token function">sendTransaction</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>rs<span class="token punctuation">)</span> <span class="token punctuation">{</span>             
        <span class="token function">verificarTransacao</span><span class="token punctuation">(</span>rs<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span>
</code></pre>
<p>A instrução <code>[i1]</code>  representa a função <code>inscrever</code> que irá inscrever o usuário atual no jogo da velha pagando o valor de inscrição.<br>
A instrução <code>[i2]</code> são os parâmetros que serão utilizados para execução da transação.<br>
A instrução <code>[i3]</code>  é a quantidade de <code>gas</code> que será utilizado para a execução desta transação.<br>
A instrução <code>[i4]</code>  é o endereço de quem irá assinar a transação.<br>
A instrução <code>[i5]</code>  é a quantidade de <code>ether</code> que será enviado junto à transação.<br>
A instrução <code>[i6]</code>  é a função que executa a função <code>inscrever</code> do smart contract na rede.</p>
<h5 id="função-verificartransacao">3.7.1.2 Função <code>verificarTransacao</code></h5>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token comment">//[i1]Consultar o status de uma transação</span>
<span class="token keyword">function</span> <span class="token function">verificarTransacao</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">//[i2]De 1 em 1 segundo, executa a função de validação que verifica se a transação já foi minerada o não</span>
    <span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                
		<span class="token comment">//[i3]busca o resultado de uma transação na rede</span>
        web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span><span class="token function">getTransactionReceipt</span><span class="token punctuation">(</span>tx<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>                    
            <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>
                window<span class="token punctuation">.</span><span class="token function">clearInterval</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
                minerando <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                minerando <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>                        
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>A instrução <code>[i1]</code> é a função de apoio <code>verificarTranscao</code>, que irá aguardar um recibo de conclusão de transação e informar que a transação foi minerada.<br>
A instrução <code>[i2]</code> define que deve ser executado de <code>1000</code> em <code>1000</code> milissegundos a função que é recebida.<br>
A instrução <code>[i3]</code> verifica na rede se há um recibo para a transação, se houver, significa que a transação foi minerada.</p>
<h4 id="funções-de-transações---block-completo">Funções de Transações - Block Completo</h4>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token comment">/** 
 * 4. REALIZAR TRANSAÇÕES (CONSOME GAS)
 **/</span>

<span class="token comment">// Cria um novo jogo (deploy de um novo contrato)</span>
<span class="token keyword">function</span> <span class="token function">newGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">//parametros utilizados para a construção do contrato do jogo</span>
    <span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
	    <span class="token comment">//valor em gas que será pago para a transação</span>
        gas<span class="token punctuation">:</span> <span class="token number">3000000</span><span class="token punctuation">,</span>        
        <span class="token comment">//quem irá assinar a transação</span>
        <span class="token keyword">from</span><span class="token punctuation">:</span> web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span>defaultAccount<span class="token punctuation">,</span>
        <span class="token comment">// binário do smart contract que será executado        </span>
        data<span class="token punctuation">:</span> contractByteCode
    <span class="token punctuation">}</span><span class="token punctuation">;</span>    
    <span class="token comment">// parametro específico do construtor do jogo, no caso o valor da inscrição</span>
    <span class="token keyword">var</span> constructorParam <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#valor-inscricao-new"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// o contrato é construído utilizando tanto a varia´vel que informa quem vai pagar quanto a variável do volor</span>
    contractInstance <span class="token operator">=</span> contract<span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>constructorParam<span class="token punctuation">,</span> params<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>rs<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// está é uma função de callback que é executada ao ser executada a transação</span>
    <span class="token comment">// validando que existe o objeto de retorno "rs" e no retorno, temos o endereço do contrato que foi criado</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>rs <span class="token operator">&amp;&amp;</span> rs<span class="token punctuation">.</span>address<span class="token punctuation">)</span><span class="token punctuation">{</span>
	        <span class="token comment">// como temos o valor de retorno, podemos construir os novos objetos e informar que o jogo foi criado</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#contract-address"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>            
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#status-new-game"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"Jogo criado."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            valorInscricao <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#valor-inscricao-new"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">atualizar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// caso não retorne, significa que não terminou de executar a transação, ficar em aguardo</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#status-new-game"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"Aguardando confirmação...."</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>        
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// A função jogar, irá realizar a execução da função "jogar" do smart contract, são recebido os parâmetros </span>
<span class="token comment">// "linha" e "coluna" que representam a posição na tabela do jogo da velha que será preenchida</span>
<span class="token keyword">function</span> <span class="token function">jogar</span><span class="token punctuation">(</span>linha<span class="token punctuation">,</span> coluna<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
	<span class="token comment">// parametros que serão usados para a execução da transação</span>
    <span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
	    <span class="token comment">// quantidade de gas que será utilizado</span>
        gas<span class="token punctuation">:</span> <span class="token number">3000000</span><span class="token punctuation">,</span>        
        <span class="token comment">// endereço de quem irá assinar a transação</span>
        <span class="token keyword">from</span><span class="token punctuation">:</span> web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span>defaultAccount<span class="token punctuation">,</span>        
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// A partir do contrato, executamos a função "jogar" passando a linha e coluna recebida </span>
    <span class="token comment">// e passando os parâmetros de execução que está presente em "params"</span>
    contractInstance<span class="token punctuation">.</span>jogar<span class="token punctuation">.</span><span class="token function">sendTransaction</span><span class="token punctuation">(</span>linha<span class="token punctuation">,</span> coluna<span class="token punctuation">,</span> params<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>tx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token comment">// Esta função será executada quando tivermos retorno da execução da função "jogar"</span>
	    <span class="token comment">// Ao conseguir jogar, verificamos o retorno da transação</span>
        <span class="token function">verificarTransacao</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// A função "inscrever" irá fazer a inscrição do jogador em um jogo da velha, utilizando o usuário que está acessando o site como assinante</span>
<span class="token keyword">function</span> <span class="token function">inscrever</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
	<span class="token comment">// parametros que serão usados para a execução da transação</span>
    <span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
	    <span class="token comment">// quantidade de gas que será utilizado</span>
        gas<span class="token punctuation">:</span> <span class="token number">3000000</span><span class="token punctuation">,</span>        
        <span class="token comment">// endereço de quem irá assinar a transação</span>
        <span class="token keyword">from</span><span class="token punctuation">:</span> web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span>defaultAccount<span class="token punctuation">,</span>
        <span class="token comment">// valor em Ether que será pago para a inscrição</span>
        value<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>valorInscricao<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>        
	<span class="token comment">// executa a função inscrever do smart contrat utilizando como parametros os valores passados em "params"</span>
   contractInstance<span class="token punctuation">.</span>inscrever<span class="token punctuation">.</span><span class="token function">sendTransaction</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>rs<span class="token punctuation">)</span> <span class="token punctuation">{</span>             
        <span class="token function">verificarTransacao</span><span class="token punctuation">(</span>rs<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span>

<span class="token comment">// Consultar o status de uma transação</span>
<span class="token keyword">function</span> <span class="token function">verificarTransacao</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// De 1 em 1 segundo, executa a função de validação que verifica se a transação já foi minerada o não</span>
    <span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                
		<span class="token comment">// busca o resultado de uma transação na rede</span>
        web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span><span class="token function">getTransactionReceipt</span><span class="token punctuation">(</span>tx<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>                    
            <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>
                window<span class="token punctuation">.</span><span class="token function">clearInterval</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
                minerando <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                minerando <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>                        
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="arquivo-completo---dapp.js">Arquivo completo - <code>dapp.js</code></h4>
<pre class=" language-javascript"><code class="prism  language-javascript"><span class="token comment">/**
 * 1. CONECTA A ALGUM PROVEDOR/REDE ETHEREUM
 */</span>

<span class="token comment">// Verifica se o navegador tem um provedor (ex. MetaMask ou MIST)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window<span class="token punctuation">.</span>web3 <span class="token operator">!==</span> <span class="token string">"undefined"</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> window<span class="token punctuation">.</span>web3<span class="token punctuation">.</span>currentProvider <span class="token operator">!==</span> <span class="token string">"undefined"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Conecta ao provedor do do navegador (usando a rede e os usuário definidos no MetaMask)</span>
    <span class="token keyword">var</span> web3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Web3</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>web3<span class="token punctuation">.</span>currentProvider<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> web3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Web3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Conecta em um provedor HTTP local (ex. Ganache ou nó/client local (ex.: GETH) )</span>
    web3<span class="token punctuation">.</span><span class="token function">setProvider</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">web3<span class="token punctuation">.</span>providers<span class="token punctuation">.</span>HttpProvider</span><span class="token punctuation">(</span><span class="token string">'http://localhost:8545'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 2. DEFINE VARIÁVEIS DA APLICAÇÃO
 */</span>

<span class="token comment">// Define um objeto contract com a interface ABI do Smart Contract JogoDaVelha (compilado no Remix e copiado no arquivo "contract.js")</span>
<span class="token keyword">var</span> contract <span class="token operator">=</span> web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span><span class="token function">contract</span><span class="token punctuation">(</span>contractABI<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Quando necessário, guarda o endereço de um contrato para ser carregado</span>
<span class="token keyword">var</span> contractAddress<span class="token punctuation">;</span>
<span class="token comment">// Guarda a instância de um contrato deployado na rede</span>
<span class="token keyword">var</span> contractInstance<span class="token punctuation">;</span>
<span class="token comment">// Guarda o endereço do Jogador 1</span>
<span class="token keyword">var</span> jogador1<span class="token punctuation">;</span>
<span class="token comment">// Guarda o endereço do Jogador 2</span>
<span class="token keyword">var</span> jogador2<span class="token punctuation">;</span>
<span class="token comment">// Guarda o endereço do Jogador da Vez</span>
<span class="token keyword">var</span> jogadorDaVez<span class="token punctuation">;</span>
<span class="token comment">// Guarda o valor da inscrição</span>
<span class="token keyword">var</span> valorInscricao<span class="token punctuation">;</span>
<span class="token comment">// Flag que indica se alguma requisições está sendo processada/minerada</span>
<span class="token keyword">var</span> minerando <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> 


<span class="token comment">/** 
 * 3. REALIZAR CONSULTAS (NÃO CONSOME GAS)
 **/</span>

<span class="token comment">// Recupera um jogo criado na rede a partir do endereço do contrato</span>
<span class="token keyword">function</span> <span class="token function">getGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    
    <span class="token comment">// Pega o endereço no campo HTML</span>
    contractAddress <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#contract-address"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Recupera a instância do contrato a paritr do endereço</span>
    contractInstance <span class="token operator">=</span> contract<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>contractAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Atualiza a página HTML</span>
    <span class="token function">atualizar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Atualiza a página HTML com os valores do contrato</span>
<span class="token keyword">function</span> <span class="token function">atualizar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Atualiza o valor da inscrição na página HTML</span>
    <span class="token function">getValorInscricao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Atualiza os jogadores na página HTML</span>
    <span class="token function">getJogadores</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Atualiza o status do jogo na página HTML</span>
    <span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Atualiza os valores do tabuleiro na página HTML</span>
    <span class="token function">getTabuleiro</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Repete a atualização a cada 2 segundos</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">atualizar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Atualiza a página com o valor da inscrição da instância do contrato</span>
<span class="token keyword">function</span> <span class="token function">getValorInscricao</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Faz uma chamada para a rede para recuperar o valor da variável valorInscricao da instância do contrato</span>
    <span class="token comment">// Uma função 'callback' deve ser passada por parâmetro</span>
    <span class="token comment">// A função 'callback' será chamada assim que a requisição retornar um valor (err e rs)</span>
    contractInstance<span class="token punctuation">.</span>valorInscricao<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>rs<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// Variáveis "uint" são retornadas como objetos que representam números grandes de uma maneria otimizada</span>
        <span class="token comment">// Para transformar esse objeto em um númor, deve ser realizada a seguinte transformação</span>
        <span class="token keyword">var</span> valorEmFormatoNumerico <span class="token operator">=</span> web3<span class="token punctuation">.</span><span class="token function">toBigNumber</span><span class="token punctuation">(</span>rs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Atualiza o componente HTML de id="valor-inscricao" com o valor da inscrição divido por 1000000000000000000 (para representar o valor em ether)</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#valor-inscricao"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">(</span>valorEmFormatoNumerico<span class="token operator">/</span><span class="token number">1000000000000000000</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" ether"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// atualiza a variável valor inscrição</span>
        valorInscricao <span class="token operator">=</span> valorEmFormatoNumerico<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>						
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Atualiza os Jogadores 1 e 2 e o Jogador da Vez</span>
<span class="token keyword">function</span> <span class="token function">getJogadores</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
    <span class="token comment">// Faz uma chamada para a rede para recuperar o valor da variável "jogador1" da instância do contrato</span>
    contractInstance<span class="token punctuation">.</span>jogador1<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>rs<span class="token punctuation">)</span><span class="token punctuation">{</span>                               
        <span class="token comment">// Atualiza a variavel jogador1</span>
        jogador1 <span class="token operator">=</span> rs<span class="token punctuation">;</span>
        <span class="token comment">// Atualiza o HTML com o endereço do jogador 1</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#jogador-1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>jogador1<span class="token punctuation">)</span><span class="token punctuation">;</span>        
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		
    <span class="token comment">// Faz uma chamada para a rede para recuperar o valor da variável "jogador2" da instância do contrato				</span>
    contractInstance<span class="token punctuation">.</span>jogador2<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>rs<span class="token punctuation">)</span><span class="token punctuation">{</span> 
        <span class="token comment">// Atualiza a variavel jogador1                              </span>
        jogador2 <span class="token operator">=</span> rs<span class="token punctuation">;</span>
        <span class="token comment">// Atualiza o HTML com o endereço do jogador 2</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#jogador-2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>jogador2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Faz uma chamada para a rede para recuperar o valor da variável "jogadorDaVez" da instância do contrato</span>
    contractInstance<span class="token punctuation">.</span>jogadorDaVez<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>rs<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// verifica se o jogador da vez foi definido</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>rs<span class="token operator">!=</span><span class="token string">"0x0000000000000000000000000000000000000000"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// atualiza a variavel jogadorDaVez</span>
            jogadorDaVez <span class="token operator">=</span> rs<span class="token punctuation">;</span>            
            <span class="token comment">// atualiza o HTML com o jogador da vez            </span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#jogador-da-vez"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">(</span>jogadorDaVez<span class="token operator">==</span>jogador1<span class="token operator">?</span><span class="token string">'&lt;b style="color:blue"&gt;JOGADOR 1&lt;/b&gt;'</span><span class="token punctuation">:</span><span class="token string">'&lt;b style="color:red"&gt;JOGADOR 2&lt;/b&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                  
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Atualiza o statudo do jogo</span>
<span class="token keyword">function</span> <span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token comment">// faz uma chamada para a função verificarEmpate da instância do contrato</span>
    contractInstance<span class="token punctuation">.</span>verificarEmpate<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>empate<span class="token punctuation">)</span><span class="token punctuation">{</span>   
        <span class="token comment">// faz uma chamada para a função verificarSeGanhou da instância do contrato             </span>
        contractInstance<span class="token punctuation">.</span>verificarSeGanhou<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>ganhou<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// verifica a flag "minerando" (definida como "true" no bloco de código seguinte)</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>minerando<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#status-jogo"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"MINERANDO..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token comment">// se verificarEmpate retorna "true" atualiza HTML com novo status</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>empate<span class="token punctuation">)</span> <span class="token punctuation">{</span>                
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#status-jogo"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"TERMINOU EMPATADO"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token comment">// se verificarSeGanhou retorna "true" atualiza HTML com novo status</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>ganhou<span class="token punctuation">)</span> <span class="token punctuation">{</span>                
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#status-jogo"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"TERMINOU COM GANHADOR"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token comment">// verifica se o jogador2 foi definido e atualiza HTML com novo status</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>jogador2<span class="token operator">==</span><span class="token string">"0x0000000000000000000000000000000000000000"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#status-jogo"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"INSCRIÇÕES ABERTAS"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                      
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// atualiza HTML com novo status</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#status-jogo"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"EM ANDAMENTO"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  
            <span class="token punctuation">}</span>                
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>						
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Atualiza a página HTML com os valores da variável `tabuleiro` da instância do contrato. </span>
<span class="token keyword">function</span> <span class="token function">getTabuleiro</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// a função getCelula reupera o valor da célula (posição linha/coluna) na instância do contrato e atuliza o HTML</span>
    <span class="token function">getCelula</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token function">getCelula</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token function">getCelula</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token function">getCelula</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token function">getCelula</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token function">getCelula</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token function">getCelula</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token function">getCelula</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token function">getCelula</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Recupera o valor de uma célula na posição linha/coluna da instância do contrato e atualiza o HTML</span>
<span class="token keyword">function</span> <span class="token function">getCelula</span><span class="token punctuation">(</span>linha<span class="token punctuation">,</span> coluna<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// faz uma chamada para a instância do contrato para a variável tabuleiro passando por parâmetro as chaves linha e coluna</span>
    contractInstance<span class="token punctuation">.</span>tabuleiro<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>linha<span class="token punctuation">,</span>coluna<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>rs<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// verifica se alguém jogou na posição</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>rs<span class="token operator">==</span><span class="token string">"0x0000000000000000000000000000000000000000"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// atualiza o HTML na linha/coluna com um link para "jogar"</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`#l</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>linha<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-c</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>coluna<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`&lt;a href="javascript:jogar(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>linha<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>coluna<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)"&gt;JOGAR&lt;/a&gt;`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// atualiza o HTML na linha/coluna com o nome do jogador que jogou na posição</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`#l</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>linha<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-c</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>coluna<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>rs<span class="token operator">==</span>jogador1<span class="token operator">?</span><span class="token template-string"><span class="token string">`&lt;b style="color:blue"&gt;JOGADOR 1&lt;/b&gt;`</span></span><span class="token punctuation">:</span><span class="token template-string"><span class="token string">`&lt;b style="color:red"&gt;JOGADOR 2&lt;/b&gt;`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>        
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/** 
 * 4. REALIZAR TRANSAÇÕES (CONSOME GAS)
 **/</span>

<span class="token comment">// Cria um novo jogo (deploy de um novo contrato)</span>
<span class="token keyword">function</span> <span class="token function">newGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
        gas<span class="token punctuation">:</span> <span class="token number">3000000</span><span class="token punctuation">,</span>        
        <span class="token keyword">from</span><span class="token punctuation">:</span> web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span>defaultAccount<span class="token punctuation">,</span>        
        data<span class="token punctuation">:</span> contractByteCode
    <span class="token punctuation">}</span><span class="token punctuation">;</span>    
    <span class="token keyword">var</span> constructorParam <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#valor-inscricao-new"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    contractInstance <span class="token operator">=</span> contract<span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span>constructorParam<span class="token punctuation">,</span> params<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>rs<span class="token punctuation">)</span><span class="token punctuation">{</span>        
        <span class="token keyword">if</span><span class="token punctuation">(</span>rs <span class="token operator">&amp;&amp;</span> rs<span class="token punctuation">.</span>address<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#contract-address"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>            
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#status-new-game"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"Jogo criado."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            valorInscricao <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#valor-inscricao-new"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">atualizar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#status-new-game"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"Aguardando confirmação...."</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>        
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// </span>
<span class="token keyword">function</span> <span class="token function">jogar</span><span class="token punctuation">(</span>linha<span class="token punctuation">,</span> coluna<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
    <span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
        gas<span class="token punctuation">:</span> <span class="token number">3000000</span><span class="token punctuation">,</span>        
        <span class="token keyword">from</span><span class="token punctuation">:</span> web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span>defaultAccount<span class="token punctuation">,</span>        
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    contractInstance<span class="token punctuation">.</span>jogar<span class="token punctuation">.</span><span class="token function">sendTransaction</span><span class="token punctuation">(</span>linha<span class="token punctuation">,</span> coluna<span class="token punctuation">,</span> params<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>tx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">verificarTransacao</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// </span>
<span class="token keyword">function</span> <span class="token function">inscrever</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
    <span class="token keyword">var</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
        gas<span class="token punctuation">:</span> <span class="token number">3000000</span><span class="token punctuation">,</span>        
        <span class="token keyword">from</span><span class="token punctuation">:</span> web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span>defaultAccount<span class="token punctuation">,</span>
        value<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>valorInscricao<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>        
    contractInstance<span class="token punctuation">.</span>inscrever<span class="token punctuation">.</span><span class="token function">sendTransaction</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>rs<span class="token punctuation">)</span> <span class="token punctuation">{</span>             
        <span class="token function">verificarTransacao</span><span class="token punctuation">(</span>rs<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span>

<span class="token comment">// Consultar o status de uma transação</span>
<span class="token keyword">function</span> <span class="token function">verificarTransacao</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                
        web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span><span class="token function">getTransactionReceipt</span><span class="token punctuation">(</span>tx<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>                    
            <span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>
                window<span class="token punctuation">.</span><span class="token function">clearInterval</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
                minerando <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                minerando <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>                        
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
</body>

</html>
